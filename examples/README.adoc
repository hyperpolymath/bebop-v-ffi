// SPDX-License-Identifier: AGPL-3.0-or-later
// SPDX-FileCopyrightText: 2025 Hyperpolymath Contributors
= Bebop-V-FFI Examples
:toc:

== Overview

This directory contains examples demonstrating how to use the Bebop-V-FFI library.

== Prerequisites

Build the Zig library first:

[source,bash]
----
cd implementations/zig
zig build -Doptimize=ReleaseFast
----

This produces:

* `zig-out/lib/libmain.so` (shared library)
* `zig-out/lib/libmain.a` (static library)

== Examples

=== decode_sensor.c

A C example demonstrating how to decode a `SensorReading` message from Bebop wire format.

.Build (dynamic linking)
[source,bash]
----
gcc -o decode_sensor decode_sensor.c \
    -L../implementations/zig/zig-out/lib -lmain \
    -Wl,-rpath,'$ORIGIN/../implementations/zig/zig-out/lib'
----

.Build (static linking)
[source,bash]
----
gcc -o decode_sensor decode_sensor.c \
    ../implementations/zig/zig-out/lib/libmain.a
----

.Run
[source,bash]
----
./decode_sensor
----

.Expected Output
----
=== Bebop-V-FFI Example: Decode SensorReading ===

ABI Version: 1.0.0

Wire data size: 68 bytes
Wire data (hex): 0100943577...00

Decoded SensorReading:
  timestamp: 2000000000
  sensor_id: "temp-001"
  sensor_type: 1 (Temperature)
  value: 23.50
  unit: "C"
  location: "floor-1"
  metadata (1 entries):
    "status": "ok"

Success!
----

== Wire Format Reference

Bebop messages use a field-indexed wire format:

[source]
----
[field_index: u8][field_data...][0x00: end]
----

Field types:
* `uint64`: 8 bytes little-endian
* `uint16`: 2 bytes little-endian
* `float64`: 8 bytes IEEE 754 little-endian
* `string`: 4-byte length (u32 LE) + UTF-8 bytes (no NUL terminator)
* `map<K,V>`: 4-byte count (u32 LE) + key-value pairs

See `../test-vectors/sensor_reading_001.json` for annotated wire format examples.

== ABI Versioning

Check the library version at runtime:

[source,c]
----
uint32_t ver = bebop_version();
uint8_t major = (ver >> 16) & 0xFF;
uint8_t minor = (ver >> 8) & 0xFF;
uint8_t patch = ver & 0xFF;
----

The ABI follows semver: 1.x.x guarantees backwards compatibility.
